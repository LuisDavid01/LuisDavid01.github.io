---
import { useTranslations } from '../i18n/utils'
import { lenguageList } from '../i18n/ui'
const currentLang = Astro.currentLocale || 'es';
const translate = useTranslations(currentLang as keyof typeof lenguageList)
---

<nav
  class="top-nav bg-background p-4 z-10 w-full
         flex gap-4 text-sm sticky top-0
         flex-nowrap md:flex-wrap
         justify-between md:justify-center
         items-center text-primary"
>

	<a href="/" class="inline-flex items-center gap-1">
		<svg
			xmlns="http://www.w3.org/2000/svg"
			width="16"
			height="16"
			viewBox="0 0 24 24"
		>
			<path
				fill="currentColor"
				d="M20 2h2v20H2v-8h2v6h4v-4h2v4h4v-6h2v6h4V4H10v2H8V2zm-8 10h2v2h-2zm-2-2h2v2h-2zm-2 0V8h2v2zm-2 2v-2h2v2zm0 0H4v2h2zm10-6h2v2h-2zm-2 0h-2v2h2zm2 4h2v2h-2z"
			></path>
		</svg>
			{translate('menu.home')}
	</a>

	<a href="#projects" class="inline-flex items-center gap-1">
		<svg
			xmlns="http://www.w3.org/2000/svg"
			width="16"
			height="16"
			viewBox="0 0 24 24"
		>
			<path
				fill="currentColor"
				d="M8 3h8v4h6v14H2V7h6zm2 4h4V5h-4zM4 9v10h16V9z"></path>
		</svg>
		{translate('menu.projects')}
	</a>

	<a href="#blog" class="inline-flex items-center gap-1">
		<svg
			xmlns="http://www.w3.org/2000/svg"
			width="16"
			height="16"
			viewBox="0 0 24 24"
		>
			<path
				fill="currentColor"
				d="M2 7h10v10H2zm8 8V9H4v6zm12-8h-8v2h8zm-8 4h8v2h-8zm8 4h-8v2h8z"
			></path>
		</svg>

		{translate('menu.blog')}
	</a>

	      <div class="relative " id="languageSelector">
        <!-- BotÃ³n principal -->
        <button 
          id="languageBtn"
          class="group relative px-4 py-3   transition-all duration-200 flex items-center space-x-3 min-w-[140px]"
        >
          <!-- Icono de idioma -->
          <div class="w-5 h-5 text-gray-600 group-hover:text-amber-700 transition-colors">
            <svg fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M7 2a1 1 0 011 1v1h3a1 1 0 110 2H9.578a18.87 18.87 0 01-1.724 4.78c.29.354.596.696.914 1.026a1 1 0 11-1.44 1.389c-.188-.196-.373-.396-.554-.6a19.098 19.098 0 01-3.107 3.567 1 1 0 01-1.334-1.49 17.087 17.087 0 003.13-3.733 18.992 18.992 0 01-1.487-2.494 1 1 0 111.79-.89c.234.47.489.928.764 1.372.417-.934.752-1.913.997-2.927H3a1 1 0 110-2h3V3a1 1 0 011-1zm6 6a1 1 0 01.894.553l2.991 5.982a.869.869 0 01.02.037l.99 1.98a1 1 0 11-1.79.895L15.383 16h-4.764l-.724 1.447a1 1 0 11-1.788-.894l.99-1.98.019-.038 2.99-5.982A1 1 0 0113 8zm-1.382 6h2.764L13 12.236 11.618 14z" clip-rule="evenodd"></path>
            </svg>
          </div>
          
          <!-- Texto del idioma actual -->
          <span id="currentLanguage" class="text-gray-700 font-medium">
            {currentLang}
          </span>
          
          <!-- Icono flecha -->
          <div class="w-4 h-4 text-gray-400 group-hover:text-gray-600 transition-all duration-200" id="arrowIcon">
            <svg fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
            </svg>
          </div>
        </button>

        <!-- Dropdown menu -->
        <div 
          id="languageDropdown" 
		  class="absolute top-full left-0 mt-2 w-full  bg-neutral-900 border border-gray-200 rounded-sm shadow-lg
		  py-2 z-99 hidden opacity-0 transform -translate-y-2 transition-all duration-200"
        >
          {Object.entries(lenguageList).map(([key, label]) => (
            <a 
              href={`/${key}`}
              class={`flex items-center space-x-3 px-4 py-3  hover:bg-neutral-800 hover:text-amber-600 transition-colors duration-150 ${
                key === currentLang ? 'bg-neutral-800 text-amber-600' : ''
              }`}
            >
              <span class="text-lg">
                {key === 'es' ? 'ðŸ‡ªðŸ‡¸' : 'ðŸ‡ºðŸ‡¸'}
              </span>
              <span class="font-medium">{label}</span>
              {key === currentLang && (
                <span class="ml-auto text-amber-600">âœ“</span>
              )}
            </a>
          ))}
        </div>
      </div>
</nav>

<style>
	#background {
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		z-index: -1;
	}
</style>
<script>
  interface LanguageSelector {
    button: HTMLButtonElement;
    dropdown: HTMLDivElement;
    arrow: HTMLDivElement;
    isOpen: boolean;
  }

  const initLanguageSelector = (): void => {
    const button = document.getElementById('languageBtn') as HTMLButtonElement;
    const dropdown = document.getElementById('languageDropdown') as HTMLDivElement;
    const arrow = document.getElementById('arrowIcon') as HTMLDivElement;
    
    if (!button || !dropdown || !arrow) return;

    const selector: LanguageSelector = {
      button,
      dropdown,
      arrow,
      isOpen: false
    };

    const openDropdown = (): void => {
      selector.isOpen = true;
      selector.dropdown.classList.remove('hidden');
      // Trigger reflow
      selector.dropdown.offsetHeight;
      selector.dropdown.classList.remove('opacity-0', '-translate-y-2');
      selector.dropdown.classList.add('opacity-100', 'translate-y-0');
      selector.arrow.style.transform = 'rotate(180deg)';
    };

    const closeDropdown = (): void => {
      if (!selector.isOpen) return;
      
      selector.isOpen = false;
      selector.dropdown.classList.remove('opacity-100', 'translate-y-0');
      selector.dropdown.classList.add('opacity-0', '-translate-y-2');
      selector.arrow.style.transform = 'rotate(0deg)';
      
      setTimeout(() => {
        selector.dropdown.classList.add('hidden');
      }, 200);
    };

    // Event listeners
    selector.button.addEventListener('click', (e: Event) => {
      e.stopPropagation();
      selector.isOpen ? closeDropdown() : openDropdown();
    });

    document.addEventListener('click', (e: Event) => {
      if (!selector.button.contains(e.target as Node) && 
          !selector.dropdown.contains(e.target as Node)) {
        closeDropdown();
      }
    });

    document.addEventListener('keydown', (e: KeyboardEvent) => {
      if (e.key === 'Escape' && selector.isOpen) {
        closeDropdown();
      }
    });
  };

  // Initialize when DOM is ready
  document.addEventListener('DOMContentLoaded', initLanguageSelector);

  document.addEventListener("astro:after-swap", () => {
   
      initLanguageSelector();

  });
    document.addEventListener("astro:page-load", () => {
   
      initLanguageSelector();

  });
</script>
